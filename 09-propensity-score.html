<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Estimating the propensity score</title>
    <meta charset="utf-8" />
    <meta name="author" content="Lucy D’Agostino McGowan" />
    <meta name="date" content="2022-02-19" />
    <script src="libs/header-attrs-2.11/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.6/tile-view.js"></script>
    <link href="libs/countdown-0.3.5/countdown.css" rel="stylesheet" />
    <script src="libs/countdown-0.3.5/countdown.js"></script>
    <link rel="stylesheet" href="css/style.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">







class: center middle main-title section-title-1

# Estimating the propensity score

.class-info[

**Session 10**

.light[STA 379/679: Causal Inference &lt;br&gt;
Lucy D'Agostino McGowan
]

]

---

class: section-title-1 title-1 middle

# Propensity score: The average unit assignment probability for units where `\(Z_i=z\)`

.footer[Imbens and Rubin (2015) Causal Inference]

---

class: title title-1
.footer[Imbens and Rubin (2015) Causal Inference]

# Propensity Score

.box-inv-1.medium[

`\(e_i(z)=\frac{1}{N(z)}\sum_{i: Z_i=z}P_i(\mathbf{Z}, \mathbf{Y}(0), \mathbf{Y}(1))\)`
]

--

&lt;br&gt; &lt;br&gt;

.box-1[

`\(N(z)\)` is the number of units where `\(Z_i = z\)` 

]
---


class: title title-1

# Under individualistic + unconfounded

.box-inv-1.medium[

`\(e_i(z)=P(X=1 | Z=z))\)`
]

---
class: title title-1

# Under individualistic + unconfounded

.box-1[

`$$P(\mathbf{X}|\mathbf{Z}, \mathbf{Y}(0), \mathbf{Y}(1)) = c\prod_{i=1}^N e(Z_i)^{X_i}(1-e(Z_i))^{1-X_i}$$`
]

&lt;br&gt;

.box-1[
The assignment mechanism is the product of the propensity scores
]

---

class: title title-1

# Propensity Score

.footer[Imbens and Rubin (2015) Causal Inference]


.box-inv-1.medium[
`$$e(z) = P(X = 1 | Z = z)$$`
]

--

.box-1[
The propensity score is a *balancing score*. Conditional on the propensity score, the distribution of `\(\mathbf{Z}\)` is similar between the exposed `\((X=1)\)` and unexposed `\((X=0)\)` units.
]
---

class: title title-1

# Estimating the propensity score

.box-1[
Can estimate it with any function `q()` that will give you an estimate of the probability that `\(X = 1\)` given `\(Z=z\)`
]

--

&lt;br&gt;

.box-1[Most often, we use logistic regression!]

---

class: title title-1

# Estimating the propensity score


.box-1[

`$$\hat{e} = \frac{1}{1+\exp\{-\mathbf{Z}\boldsymbol\beta\}}$$`
]

---

class: title title-1

# Estimating the propensity score


```r
glm(x ~ z1 + z2 + z3 + ..., 
    data = data, 
    family = binomial())
```

---

class: title title-1

# Estimating the propensity score


```r
*glm(x ~ z1 + z2 + z3 + ...,
    data = data, 
    family = binomial())
```

--

.box-1[Exposure is the outcome, all confounders on the righthand side]
---


class: title title-1

# Estimating the propensity score


```r
glm(x ~ z1 + z2 + z3 + ..., 
    data = data, 
*   family = binomial())
```

---

class: title title-1

# Estimating the propensity score


```r
glm(x ~ z1 + z2 + z3 + ..., 
    data = data, 
    family = binomial()) %&gt;%
  predict(type = "response")
```

---

class: title title-1

# Estimating the propensity score


```r
glm(x ~ z1 + z2 + z3 + ..., 
    data = data, 
    family = binomial()) %&gt;%
* predict(type = "response")
```

--

.box-1[
These are the propensity scores!
]

---

class: title title-1

# Estimating the propensity score


```r
glm(x ~ z1 + z2 + z3 + ..., 
    data = data, 
    family = binomial()) %&gt;%
* predict(type = "response")
```

---

class: title title-1

# Example
.footer[https://wwwn.cdc.gov/nchs/nhanes/nhefs/default.aspx/]
![](img/nhane.png)

--

.box-1[
The NHANES - Epidemiologic Follow-up Study (NHEFS) is a national longitudinal study
]

--
&lt;br&gt;
.box-1[
It was designed to investigate the relationships between clinical, nutritional, &amp; behavioral factors and morbidity, mortality, and hospital utilization
]
---

class: title title-1

# Example

.small[

```
## # A tibble: 1,566 × 67
##     qsmk  wt82  seqn death yrdth modth dadth   sbp   dbp sex     age race 
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;
##  1     0  68.9   233     0    NA    NA    NA   175    96 0        42 1    
##  2     0  61.2   235     0    NA    NA    NA   123    80 0        36 0    
##  3     0  66.2   244     0    NA    NA    NA   115    75 1        56 1    
##  4     0  64.4   245     1    85     2    14   148    78 0        68 1    
##  5     0  92.1   252     0    NA    NA    NA   118    77 0        40 0    
##  6     0 103.    257     0    NA    NA    NA   141    83 1        43 1    
##  7     0  59.0   262     0    NA    NA    NA   132    69 1        56 0    
##  8     0  59.0   266     0    NA    NA    NA   100    53 1        29 0    
##  9     0  62.1   419     1    84    10    13   163    79 0        51 0    
## 10     0  72.1   420     1    86    10    17   184   106 0        43 0    
## # … with 1,556 more rows, and 55 more variables: income &lt;dbl&gt;, marital &lt;dbl&gt;,
## #   school &lt;dbl&gt;, education &lt;fct&gt;, ht &lt;dbl&gt;, wt71 &lt;dbl&gt;, wt82_71 &lt;dbl&gt;,
## #   birthplace &lt;dbl&gt;, smokeintensity &lt;dbl&gt;, smkintensity82_71 &lt;dbl&gt;,
## #   smokeyrs &lt;dbl&gt;, asthma &lt;dbl&gt;, bronch &lt;dbl&gt;, tb &lt;dbl&gt;, hf &lt;dbl&gt;, hbp &lt;dbl&gt;,
## #   pepticulcer &lt;dbl&gt;, colitis &lt;dbl&gt;, hepatitis &lt;dbl&gt;, chroniccough &lt;dbl&gt;,
## #   hayfever &lt;dbl&gt;, diabetes &lt;dbl&gt;, polio &lt;dbl&gt;, tumor &lt;dbl&gt;,
## #   nervousbreak &lt;dbl&gt;, alcoholpy &lt;dbl&gt;, alcoholfreq &lt;dbl&gt;, …
```
]

---

class: title title-1

# Example

.box-1.medium[Causal Question]

--

.box-inv-1[Do people in the US who quit smoking between 1972 and 1982 weight more in 1982 compared to those who did not quite smoking?]

---

class: title title-1

# <svg aria-hidden="true" role="img" viewBox="0 0 640 512" style="height:1em;width:1.25em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M624 416H381.54c-.74 19.81-14.71 32-32.74 32H288c-18.69 0-33.02-17.47-32.77-32H16c-8.8 0-16 7.2-16 16v16c0 35.2 28.8 64 64 64h512c35.2 0 64-28.8 64-64v-16c0-8.8-7.2-16-16-16zM576 48c0-26.4-21.6-48-48-48H112C85.6 0 64 21.6 64 48v336h512V48zm-64 272H128V64h384v256z"/></svg> Application Exercise

.box-inv-1[Do people in the US who quit smoking between 1972 and 1982 weight more in 1982 compared to those who did not quite smoking?]

1. Using the `ggdag` package draw a DAG for the causal question
2. Determine the ideal "adjustment set(s)"
2. Knit commit &amp; push to GitHub

<div class="countdown" id="timer_62115056" style="right:0;bottom:0;font-size:2em;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">08</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
---

class: title title-1

# <svg aria-hidden="true" role="img" viewBox="0 0 640 512" style="height:1em;width:1.25em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M624 416H381.54c-.74 19.81-14.71 32-32.74 32H288c-18.69 0-33.02-17.47-32.77-32H16c-8.8 0-16 7.2-16 16v16c0 35.2 28.8 64 64 64h512c35.2 0 64-28.8 64-64v-16c0-8.8-7.2-16-16-16zM576 48c0-26.4-21.6-48-48-48H112C85.6 0 64 21.6 64 48v336h512V48zm-64 272H128V64h384v256z"/></svg> Application Exercise


1. `install.packages("causaldata")`
2. Examine the variables included in the data by looking at the `nhefs_codebook`
3. Mark any variables in your DAG that **aren't** in this dataset as latent and examine the adjustment sets
4. Knit commit &amp; push to GitHub

<div class="countdown" id="timer_62114e3b" style="right:0;bottom:0;font-size:2em;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">08</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

class: title title-1

# Example

.small[

```r
nhefs_complete_uc &lt;- nhefs_complete %&gt;% 
  filter(censored == 0)

glm(qsmk ~ wt71 + age + marital + race + sex, 
    data = nhefs_complete_uc,
    family = binomial()) %&gt;%
  predict(type = "response")
```

```
##          1          2          3          4          5          6          7 
## 0.19172434 0.23800115 0.18053478 0.26153888 0.29502157 0.17190857 0.29867390 
##          8          9         10         11         12         13         14 
## 0.18177665 0.31537510 0.27343856 0.27582612 0.26468958 0.27525395 0.23375494 
##         15         16         17         18         19         20         21 
## 0.39646398 0.25860864 0.35961465 0.26025971 0.32041111 0.26060064 0.21220084 
##         22         23         24         25         26         27         28 
## 0.24288989 0.19363705 0.22077029 0.30621631 0.21928775 0.34094108 0.32468383 
##         29         30         31         32         33         34         35 
## 0.20319878 0.28088485 0.37055389 0.37347681 0.24952875 0.19667019 0.38067887 
##         36         37         38         39         40         41         42 
## 0.25640594 0.20230948 0.18712528 0.17605079 0.18516958 0.40717049 0.26965729 
##         43         44         45         46         47         48         49 
## 0.28568237 0.24959263 0.37216828 0.24587933 0.28918263 0.13915320 0.26992162 
##         50         51         52         53         54         55         56 
## 0.22220559 0.17420740 0.13803467 0.19411381 0.15191033 0.20082388 0.21235424 
##         57         58         59         60         61         62         63 
## 0.19666802 0.34710900 0.27962348 0.20104832 0.31600741 0.08003096 0.13428200 
##         64         65         66         67         68         69         70 
## 0.15516741 0.24934255 0.29862145 0.16633243 0.22805236 0.25808823 0.20035839 
##         71         72         73         74         75         76         77 
## 0.26789935 0.24278134 0.38465957 0.18696792 0.20144252 0.39656071 0.16994569 
##         78         79         80         81         82         83         84 
## 0.15574796 0.15360275 0.28711869 0.37935324 0.22937636 0.16089446 0.23950670 
##         85         86         87         88         89         90         91 
## 0.30635396 0.20601841 0.19887409 0.21132305 0.19256331 0.09611814 0.15487864 
##         92         93         94         95         96         97         98 
## 0.28748208 0.19172107 0.13655816 0.31884071 0.21333656 0.27093482 0.33498584 
##         99        100        101        102        103        104        105 
## 0.28339490 0.26901907 0.26216911 0.17601902 0.11626091 0.18201550 0.32185092 
##        106        107        108        109        110        111        112 
## 0.27728929 0.39961835 0.21739434 0.30314032 0.22534562 0.14120794 0.14999687 
##        113        114        115        116        117        118        119 
## 0.33722906 0.31905019 0.29691635 0.20911873 0.27858289 0.20093265 0.22221956 
##        120        121        122        123        124        125        126 
## 0.16145466 0.28314850 0.27450886 0.26188038 0.21917247 0.27836998 0.36747360 
##        127        128        129        130        131        132        133 
## 0.17086901 0.22881929 0.32172069 0.23217304 0.21952373 0.39156403 0.20993007 
##        134        135        136        137        138        139        140 
## 0.21545275 0.18371966 0.27853257 0.19835017 0.24595497 0.28034969 0.30594295 
##        141        142        143        144        145        146        147 
## 0.23403833 0.29309571 0.19811106 0.15230376 0.18249170 0.26640260 0.27685303 
##        148        149        150        151        152        153        154 
## 0.31857719 0.33220915 0.39588245 0.29361007 0.26395661 0.28537718 0.17010455 
##        155        156        157        158        159        160        161 
## 0.12564947 0.25625811 0.30680925 0.21043770 0.31926711 0.14764096 0.27364220 
##        162        163        164        165        166        167        168 
## 0.21611981 0.34743458 0.19493740 0.34267049 0.29425101 0.35433381 0.34592420 
##        169        170        171        172        173        174        175 
## 0.16727380 0.32646773 0.31835455 0.15387957 0.22923865 0.29817836 0.15937625 
##        176        177        178        179        180        181        182 
## 0.22415781 0.40180841 0.37022064 0.34456615 0.41331655 0.25446315 0.32006229 
##        183        184        185        186        187        188        189 
## 0.29760567 0.16818602 0.35347194 0.27945309 0.10739917 0.35584478 0.32883478 
##        190        191        192        193        194        195        196 
## 0.23284137 0.15254983 0.18465878 0.44268103 0.11836676 0.23220241 0.18220431 
##        197        198        199        200        201        202        203 
## 0.34679728 0.23661316 0.29205110 0.24310315 0.25425919 0.21697031 0.38563267 
##        204        205        206        207        208        209        210 
## 0.33637440 0.14673154 0.18818443 0.30822132 0.16444876 0.21216484 0.22702490 
##        211        212        213        214        215        216        217 
## 0.27997385 0.38883743 0.42875225 0.30664998 0.19615616 0.25641885 0.31369818 
##        218        219        220        221        222        223        224 
## 0.25045049 0.16580487 0.28161474 0.34183413 0.29099126 0.37493497 0.28657283 
##        225        226        227        228        229        230        231 
## 0.21593366 0.38614165 0.27574539 0.28146770 0.10459433 0.24338494 0.32648205 
##        232        233        234        235        236        237        238 
## 0.19306334 0.22852471 0.22714843 0.14276140 0.21905091 0.16428547 0.21005534 
##        239        240        241        242        243        244        245 
## 0.31139029 0.25055097 0.20021418 0.29496344 0.31309540 0.28804268 0.26070428 
##        246        247        248        249        250        251        252 
## 0.26478684 0.30755814 0.25804206 0.33881047 0.28479318 0.34493927 0.24207866 
##        253        254        255        256        257        258        259 
## 0.15225630 0.36763808 0.21140051 0.16164462 0.42303479 0.36876914 0.23929560 
##        260        261        262        263        264        265        266 
## 0.24336686 0.30542701 0.35023510 0.31884071 0.20967293 0.24552151 0.36970507 
##        267        268        269        270        271        272        273 
## 0.43616367 0.29497049 0.20949649 0.27303556 0.14345044 0.15504548 0.23355996 
##        274        275        276        277        278        279        280 
## 0.18888493 0.24202850 0.20551024 0.11663098 0.25485343 0.31909021 0.20383713 
##        281        282        283        284        285        286        287 
## 0.39221808 0.36798702 0.29730627 0.34932801 0.39755833 0.21519306 0.39393365 
##        288        289        290        291        292        293        294 
## 0.19648112 0.25299684 0.29733808 0.29352187 0.33757659 0.36768225 0.27112535 
##        295        296        297        298        299        300        301 
## 0.30989726 0.19427749 0.28692868 0.23054830 0.13945734 0.18616870 0.19003529 
##        302        303        304        305        306        307        308 
## 0.35025599 0.30879309 0.22583499 0.33608781 0.19975034 0.32668059 0.19777187 
##        309        310        311        312        313        314        315 
## 0.33169910 0.27898284 0.35255412 0.24517549 0.23683959 0.24248404 0.29521666 
##        316        317        318        319        320        321        322 
## 0.22733568 0.22364983 0.16075890 0.25070230 0.20435248 0.33671480 0.32223738 
##        323        324        325        326        327        328        329 
## 0.18880108 0.22485856 0.33932031 0.31836212 0.30468742 0.09614586 0.11647024 
##        330        331        332        333        334        335        336 
## 0.18071994 0.24038540 0.36159607 0.29608443 0.16232514 0.37390759 0.27518483 
##        337        338        339        340        341        342        343 
## 0.21505191 0.23314085 0.42799583 0.19198162 0.17391564 0.18883483 0.32149710 
##        344        345        346        347        348        349        350 
## 0.36942231 0.26006157 0.39344923 0.31212449 0.19723910 0.16660708 0.34689653 
##        351        352        353        354        355        356        357 
## 0.20846319 0.21234230 0.32377741 0.34039588 0.16613668 0.16843380 0.27709608 
##        358        359        360        361        362        363        364 
## 0.23241693 0.21927629 0.21662334 0.11649438 0.13807447 0.29763041 0.32552412 
##        365        366        367        368        369        370        371 
## 0.23884834 0.38222374 0.27070113 0.12369078 0.28357084 0.17981595 0.36431663 
##        372        373        374        375        376        377        378 
## 0.38846890 0.21180606 0.19673667 0.19256801 0.35294424 0.30632673 0.35114098 
##        379        380        381        382        383        384        385 
## 0.19103838 0.23832298 0.22044406 0.19449757 0.11843689 0.19480466 0.41532733 
##        386        387        388        389        390        391        392 
## 0.28222359 0.28900307 0.29004826 0.26755233 0.23741963 0.28517980 0.22471068 
##        393        394        395        396        397        398        399 
## 0.20170349 0.29815841 0.25682213 0.34271303 0.23469099 0.31719262 0.17228429 
##        400        401        402        403        404        405        406 
## 0.24490554 0.23547427 0.17897405 0.24564945 0.22349836 0.25618038 0.26405299 
##        407        408        409        410        411        412        413 
## 0.27923439 0.30552386 0.09821396 0.17609172 0.24261456 0.21891765 0.17441361 
##        414        415        416        417        418        419        420 
## 0.31850913 0.36343016 0.40813357 0.19048521 0.22871722 0.31871331 0.20901278 
##        421        422        423        424        425        426        427 
## 0.24729177 0.27835045 0.19990937 0.25897860 0.28601845 0.27356114 0.38937190 
##        428        429        430        431        432        433        434 
## 0.23080483 0.23972671 0.24753416 0.28726675 0.09654417 0.34500926 0.32447242 
##        435        436        437        438        439        440        441 
## 0.39825930 0.28737526 0.14254816 0.31296391 0.35948379 0.10717627 0.27371122 
##        442        443        444        445        446        447        448 
## 0.28729585 0.29323112 0.29623401 0.32122663 0.22580614 0.27119801 0.35939260 
##        449        450        451        452        453        454        455 
## 0.21244672 0.30058112 0.23863896 0.17420740 0.15731000 0.21190508 0.15909337 
##        456        457        458        459        460        461        462 
## 0.18557642 0.18628563 0.35101421 0.28927628 0.17393773 0.15053454 0.23439078 
##        463        464        465        466        467        468        469 
## 0.19255017 0.26422918 0.30618068 0.36417229 0.25262040 0.39995489 0.22700788 
##        470        471        472        473        474        475        476 
## 0.19812402 0.30996942 0.25551617 0.23297322 0.23799451 0.19012247 0.18886006 
##        477        478        479        480        481        482        483 
## 0.19634759 0.39725383 0.15189262 0.35796026 0.14356661 0.37704692 0.33809336 
##        484        485        486        487        488        489        490 
## 0.31078347 0.23975541 0.33327356 0.22860131 0.17339751 0.16511265 0.34420768 
##        491        492        493        494        495        496        497 
## 0.17331777 0.25649525 0.27857608 0.27185600 0.24936484 0.29659395 0.29972428 
##        498        499        500        501        502        503        504 
## 0.26760729 0.23753316 0.37259610 0.20505473 0.22758808 0.20796359 0.27038112 
##        505        506        507        508        509        510        511 
## 0.24907448 0.31243143 0.27409960 0.19267334 0.30788290 0.26530162 0.21953113 
##        512        513        514        515        516        517        518 
## 0.32901789 0.32577532 0.18641658 0.26816334 0.20279305 0.35982030 0.24297417 
##        519        520        521        522        523        524        525 
## 0.32121063 0.19710518 0.26877526 0.31992389 0.25838181 0.24117111 0.17888987 
##        526        527        528        529        530        531        532 
## 0.34519989 0.29350174 0.27157318 0.25860864 0.24827193 0.20157216 0.30003142 
##        533        534        535        536        537        538        539 
## 0.20109238 0.32494999 0.36719858 0.31972725 0.23814249 0.23076058 0.33717413 
##        540        541        542        543        544        545        546 
## 0.14762722 0.22317909 0.28860640 0.22389343 0.23577574 0.28639447 0.36237239 
##        547        548        549        550        551        552        553 
## 0.18162877 0.17346032 0.30227913 0.11892117 0.26982218 0.21095448 0.18788996 
##        554        555        556        557        558        559        560 
## 0.23869090 0.16757740 0.30776355 0.20533103 0.30981003 0.39365114 0.13899734 
##        561        562        563        564        565        566        567 
## 0.28464140 0.36515324 0.34403182 0.23951109 0.17342599 0.28293237 0.26220120 
##        568        569        570        571        572        573        574 
## 0.39277260 0.22854571 0.19942614 0.31405390 0.30296241 0.30908527 0.12721709 
##        575        576        577        578        579        580        581 
## 0.26177868 0.19070201 0.31698379 0.39051955 0.32066205 0.25317602 0.32904766 
##        582        583        584        585        586        587        588 
## 0.12911646 0.39737984 0.10515652 0.32145591 0.24583871 0.25100135 0.26847251 
##        589        590        591        592        593        594        595 
## 0.22056741 0.27992360 0.18648613 0.30516960 0.28358335 0.20808744 0.23663667 
##        596        597        598        599        600        601        602 
## 0.33731201 0.22343393 0.38131983 0.19210195 0.23002705 0.22360433 0.26755324 
##        603        604        605        606        607        608        609 
## 0.31022906 0.22981880 0.27713922 0.16035081 0.39779656 0.27166514 0.18190921 
##        610        611        612        613        614        615        616 
## 0.22973998 0.27450886 0.23605861 0.16426022 0.26762529 0.46529796 0.41063940 
##        617        618        619        620        621        622        623 
## 0.22051194 0.33876058 0.23089290 0.18573136 0.27682733 0.24256453 0.32918387 
##        624        625        626        627        628        629        630 
## 0.25239480 0.29487862 0.43457913 0.27256003 0.34424948 0.25109788 0.32751023 
##        631        632        633        634        635        636        637 
## 0.40561551 0.28813516 0.27726298 0.34782832 0.26509780 0.26903118 0.48559140 
##        638        639        640        641        642        643        644 
## 0.29621511 0.21490913 0.18712988 0.45218722 0.33208490 0.25301349 0.28133109 
##        645        646        647        648        649        650        651 
## 0.30578981 0.32031651 0.21083625 0.20631619 0.27470698 0.23190531 0.24581677 
##        652        653        654        655        656        657        658 
## 0.26103996 0.28143214 0.19889001 0.22323390 0.18014768 0.16303373 0.27542167 
##        659        660        661        662        663        664        665 
## 0.22920168 0.14309872 0.18380468 0.28868470 0.36680676 0.34079321 0.16772602 
##        666        667        668        669        670        671        672 
## 0.33063723 0.24916209 0.23938002 0.32886090 0.34222939 0.35863934 0.25628137 
##        673        674        675        676        677        678        679 
## 0.27279546 0.26156778 0.23520060 0.31042231 0.18809696 0.35501673 0.42414446 
##        680        681        682        683        684        685        686 
## 0.22482455 0.17489816 0.29160723 0.25196799 0.16124478 0.31986363 0.38567741 
##        687        688        689        690        691        692        693 
## 0.36322806 0.26116604 0.32347704 0.29822902 0.34278363 0.33795121 0.34825283 
##        694        695        696        697        698        699        700 
## 0.36159607 0.31599887 0.29400531 0.22771913 0.32254457 0.36681485 0.38352545 
##        701        702        703        704        705        706        707 
## 0.30161566 0.33992659 0.30375898 0.21515714 0.30491232 0.41325610 0.27514187 
##        708        709        710        711        712        713        714 
## 0.34696091 0.24159831 0.17263195 0.28547940 0.16630069 0.23124698 0.23267051 
##        715        716        717        718        719        720        721 
## 0.28715283 0.26239809 0.20960095 0.33606141 0.21422214 0.30822132 0.36857308 
##        722        723        724        725        726        727        728 
## 0.29666936 0.31265848 0.39498222 0.26915569 0.30862036 0.28540313 0.35879051 
##        729        730        731        732        733        734        735 
## 0.20814470 0.34520672 0.29591212 0.33573507 0.28220727 0.33688045 0.23836757 
##        736        737        738        739        740        741        742 
## 0.32595517 0.26335264 0.29854198 0.28379904 0.28428726 0.27284419 0.41671164 
##        743        744        745        746        747        748        749 
## 0.25287266 0.20924474 0.26156194 0.27120398 0.24903917 0.23554771 0.27557043 
##        750        751        752        753        754        755        756 
## 0.20927599 0.21413314 0.22183814 0.23688465 0.33382798 0.21574699 0.26353368 
##        757        758        759        760        761        762        763 
## 0.17817442 0.24869579 0.18958785 0.18909978 0.32882811 0.23673288 0.30709450 
##        764        765        766        767        768        769        770 
## 0.29305658 0.34204660 0.22090952 0.35446804 0.30919766 0.26653504 0.24867299 
##        771        772        773        774        775        776        777 
## 0.39770850 0.20533985 0.23191773 0.39784904 0.26266377 0.30986334 0.34628434 
##        778        779        780        781        782        783        784 
## 0.23507697 0.17567163 0.17704278 0.30925815 0.28512358 0.18640173 0.30006473 
##        785        786        787        788        789        790        791 
## 0.30827447 0.31939580 0.25323722 0.20986303 0.28897899 0.28914382 0.24658453 
##        792        793        794        795        796        797        798 
## 0.27594332 0.34992975 0.28435497 0.26388933 0.30830049 0.21243539 0.34560694 
##        799        800        801        802        803        804        805 
## 0.31094035 0.15806477 0.30567170 0.30318660 0.21060528 0.18012777 0.35722221 
##        806        807        808        809        810        811        812 
## 0.39904338 0.22015496 0.36765388 0.19248391 0.23209495 0.25622721 0.28274289 
##        813        814        815        816        817        818        819 
## 0.14697269 0.32833954 0.29367720 0.19280470 0.21821343 0.16012191 0.21587251 
##        820        821        822        823        824        825        826 
## 0.30583710 0.15970507 0.31806361 0.22833324 0.25878177 0.18510652 0.31165058 
##        827        828        829        830        831        832        833 
## 0.16500577 0.20393236 0.29061242 0.17900624 0.15423020 0.23145205 0.27526017 
##        834        835        836        837        838        839        840 
## 0.26272398 0.25282556 0.19879655 0.31928024 0.25723735 0.15565557 0.24416874 
##        841        842        843        844        845        846        847 
## 0.27288166 0.29959347 0.31969995 0.26804696 0.23153471 0.42593383 0.16830430 
##        848        849        850        851        852        853        854 
## 0.27364220 0.19898511 0.32894508 0.24956977 0.19649658 0.40446022 0.24999511 
##        855        856        857        858        859        860        861 
## 0.26652069 0.19042897 0.27142577 0.15916908 0.26091250 0.24499148 0.15250282 
##        862        863        864        865        866        867        868 
## 0.18779338 0.19061005 0.22408226 0.25051485 0.17982177 0.17619030 0.28333685 
##        869        870        871        872        873        874        875 
## 0.35139058 0.26697412 0.30598227 0.22875587 0.15508393 0.20960095 0.20969315 
##        876        877        878        879        880        881        882 
## 0.25952888 0.25049162 0.18431858 0.39670199 0.13854797 0.28887012 0.24885390 
##        883        884        885        886        887        888        889 
## 0.16894992 0.29858846 0.25099894 0.17759117 0.21110557 0.31334918 0.30621302 
##        890        891        892        893        894        895        896 
## 0.32397395 0.17605079 0.26517355 0.21461510 0.17418024 0.33957067 0.42493676 
##        897        898        899        900        901        902        903 
## 0.26690022 0.24697299 0.27654793 0.24448486 0.24294011 0.23292394 0.31300769 
##        904        905        906        907        908        909        910 
## 0.19885030 0.22374121 0.28667853 0.28821057 0.16372083 0.35726557 0.19231757 
##        911        912        913        914        915        916        917 
## 0.26162300 0.29789892 0.26864932 0.36233574 0.18185494 0.31762438 0.34599454 
##        918        919        920        921        922        923        924 
## 0.21532298 0.16994105 0.30680006 0.32075771 0.39573974 0.26825548 0.24636884 
##        925        926        927        928        929        930        931 
## 0.32250250 0.30260149 0.17867160 0.14363765 0.37086696 0.25369079 0.18162877 
##        932        933        934        935        936        937        938 
## 0.28095374 0.31073655 0.17753748 0.25196229 0.32957040 0.19625720 0.19594622 
##        939        940        941        942        943        944        945 
## 0.23902370 0.20604271 0.17425595 0.39761080 0.34052083 0.09609145 0.22215603 
##        946        947        948        949        950        951        952 
## 0.31561164 0.32784527 0.18871606 0.18802234 0.30461516 0.23182939 0.21488407 
##        953        954        955        956        957        958        959 
## 0.23178500 0.34304946 0.22327508 0.24640541 0.24965750 0.20044064 0.14982972 
##        960        961        962        963        964        965        966 
## 0.16968157 0.23719763 0.27747024 0.25392064 0.20623019 0.25971424 0.22552040 
##        967        968        969        970        971        972        973 
## 0.36669966 0.17999782 0.32842869 0.22852471 0.24402496 0.19107690 0.30151640 
##        974        975        976        977        978        979        980 
## 0.27654060 0.18061673 0.28525755 0.21713420 0.12462958 0.29562440 0.20048751 
##        981        982        983        984        985        986        987 
## 0.17665126 0.12725903 0.22702490 0.37794688 0.16780371 0.18019004 0.24112549 
##        988        989        990        991        992        993        994 
## 0.16337446 0.16724328 0.22593294 0.24853513 0.15285393 0.20687498 0.32085317 
##        995        996        997        998        999       1000       1001 
## 0.22462829 0.19309962 0.29742331 0.23576153 0.23296553 0.16996201 0.19257171 
##       1002       1003       1004       1005       1006       1007       1008 
## 0.27377049 0.17823859 0.33331552 0.17665404 0.23519286 0.25337433 0.16637786 
##       1009       1010       1011       1012       1013       1014       1015 
## 0.20865853 0.33133975 0.22444904 0.25097655 0.32232627 0.30188545 0.32259802 
##       1016       1017       1018       1019       1020       1021       1022 
## 0.35364228 0.24553888 0.26467154 0.27821313 0.28461040 0.23767365 0.33253519 
##       1023       1024       1025       1026       1027       1028       1029 
## 0.27384594 0.16966836 0.19425627 0.20144679 0.39612756 0.25009960 0.11880615 
##       1030       1031       1032       1033       1034       1035       1036 
## 0.24536706 0.23144110 0.33287283 0.24448604 0.19771675 0.25723735 0.34844324 
##       1037       1038       1039       1040       1041       1042       1043 
## 0.45063659 0.36173849 0.31448887 0.34939867 0.32411710 0.29126630 0.20997365 
##       1044       1045       1046       1047       1048       1049       1050 
## 0.27200877 0.30213569 0.29997350 0.28693371 0.28287005 0.24498657 0.18481343 
##       1051       1052       1053       1054       1055       1056       1057 
## 0.32609213 0.26136988 0.17548082 0.19430693 0.29939116 0.32847782 0.20970317 
##       1058       1059       1060       1061       1062       1063       1064 
## 0.16489604 0.32951533 0.26803849 0.24677496 0.19784139 0.31499956 0.21688030 
##       1065       1066       1067       1068       1069       1070       1071 
## 0.18704203 0.22421713 0.15788429 0.16819972 0.24277579 0.27260420 0.22617302 
##       1072       1073       1074       1075       1076       1077       1078 
## 0.38362904 0.13801220 0.14359355 0.17540759 0.12562500 0.22277315 0.11989999 
##       1079       1080       1081       1082       1083       1084       1085 
## 0.26658969 0.22112482 0.38195147 0.25069094 0.33308087 0.19419086 0.20865853 
##       1086       1087       1088       1089       1090       1091       1092 
## 0.26577501 0.18305923 0.18589929 0.15699351 0.18959463 0.26080010 0.17116361 
##       1093       1094       1095       1096       1097       1098       1099 
## 0.23424622 0.36497348 0.12756608 0.32948110 0.38137151 0.12462337 0.18281594 
##       1100       1101       1102       1103       1104       1105       1106 
## 0.18728636 0.33191291 0.11048871 0.24817958 0.19914309 0.11934847 0.22665480 
##       1107       1108       1109       1110       1111       1112       1113 
## 0.24652747 0.13261536 0.18607831 0.09803128 0.13146932 0.13652295 0.18749477 
##       1114       1115       1116       1117       1118       1119       1120 
## 0.27306207 0.32906100 0.24627779 0.31934818 0.40881861 0.31561164 0.31202395 
##       1121       1122       1123       1124       1125       1126       1127 
## 0.27455851 0.16189607 0.30939131 0.26984725 0.39354745 0.23435579 0.17431900 
##       1128       1129       1130       1131       1132       1133       1134 
## 0.25297209 0.16602927 0.22174446 0.20215389 0.23572207 0.16599895 0.31935552 
##       1135       1136       1137       1138       1139       1140       1141 
## 0.29474119 0.35093532 0.18124024 0.36076995 0.18026225 0.40168920 0.27100744 
##       1142       1143       1144       1145       1146       1147       1148 
## 0.18849681 0.26241780 0.22428809 0.27657838 0.29258031 0.17306574 0.31258011 
##       1149       1150       1151       1152       1153       1154       1155 
## 0.31899817 0.17973215 0.32785193 0.22877141 0.28196149 0.15381534 0.24909845 
##       1156       1157       1158       1159       1160       1161       1162 
## 0.22582507 0.27238706 0.28444433 0.28261037 0.39217306 0.31155660 0.40514332 
##       1163       1164       1165       1166       1167       1168       1169 
## 0.26747259 0.16064294 0.20920512 0.29401291 0.22495510 0.29596217 0.26751623 
##       1170       1171       1172       1173       1174       1175       1176 
## 0.33501220 0.20183326 0.41655926 0.34176589 0.20699790 0.33493704 0.28587245 
##       1177       1178       1179       1180       1181       1182       1183 
## 0.15473928 0.41932366 0.23492554 0.25121580 0.19764493 0.16908537 0.31201957 
##       1184       1185       1186       1187       1188       1189       1190 
## 0.37816652 0.14775358 0.17634537 0.16647458 0.20411632 0.08865094 0.13870350 
##       1191       1192       1193       1194       1195       1196       1197 
## 0.15460167 0.13947051 0.32364600 0.20466994 0.18410328 0.22818126 0.12582924 
##       1198       1199       1200       1201       1202       1203       1204 
## 0.38769876 0.11276314 0.21847643 0.20598752 0.18733257 0.24198634 0.21247068 
##       1205       1206       1207       1208       1209       1210       1211 
## 0.29311581 0.25151077 0.19644654 0.19834056 0.29347094 0.30278492 0.16005646 
##       1212       1213       1214       1215       1216       1217       1218 
## 0.28193679 0.25891966 0.39544956 0.33120978 0.34891060 0.25425469 0.29119102 
##       1219       1220       1221       1222       1223       1224       1225 
## 0.38552062 0.24498098 0.23156897 0.28938090 0.31963197 0.15783581 0.31251981 
##       1226       1227       1228       1229       1230       1231       1232 
## 0.29626632 0.42303479 0.29720193 0.27946526 0.39914845 0.21212761 0.33495050 
##       1233       1234       1235       1236       1237       1238       1239 
## 0.21765382 0.26901907 0.28899614 0.19296569 0.31958433 0.15086919 0.33466533 
##       1240       1241       1242       1243       1244       1245       1246 
## 0.21653131 0.21833667 0.21305146 0.24961646 0.16663466 0.31755047 0.34250944 
##       1247       1248       1249       1250       1251       1252       1253 
## 0.27521095 0.32476525 0.11562903 0.30085564 0.26502318 0.25825590 0.26625035 
##       1254       1255       1256       1257       1258       1259       1260 
## 0.14394256 0.13664023 0.15071107 0.24203847 0.29818391 0.34128289 0.33932031 
##       1261       1262       1263       1264       1265       1266       1267 
## 0.25994765 0.17704278 0.29188165 0.25972005 0.25937987 0.37372606 0.17854194 
##       1268       1269       1270       1271       1272       1273       1274 
## 0.35365003 0.29347644 0.12573470 0.21184065 0.32085216 0.23146280 0.30452877 
##       1275       1276       1277       1278       1279       1280       1281 
## 0.39228471 0.16451305 0.22022500 0.22262891 0.14672717 0.19727379 0.32276112 
##       1282       1283       1284       1285       1286       1287       1288 
## 0.21615693 0.20618114 0.25482993 0.25025228 0.31530226 0.20167530 0.24830717 
##       1289       1290       1291       1292       1293       1294       1295 
## 0.33387670 0.35534485 0.25203918 0.23346828 0.26816334 0.38610405 0.18949788 
##       1296       1297       1298       1299       1300       1301       1302 
## 0.18347816 0.14297446 0.24125749 0.16844443 0.39616528 0.12872303 0.17876896 
##       1303       1304       1305       1306       1307       1308       1309 
## 0.39350150 0.38546267 0.21652618 0.24273619 0.30750506 0.29912398 0.22436894 
##       1310       1311       1312       1313       1314       1315       1316 
## 0.27685835 0.27198082 0.25403943 0.28182693 0.31716699 0.21516225 0.30018796 
##       1317       1318       1319       1320       1321       1322       1323 
## 0.28785378 0.14219290 0.11324670 0.20573126 0.21501942 0.29045804 0.36482818 
##       1324       1325       1326       1327       1328       1329       1330 
## 0.12754804 0.11785185 0.14652231 0.28815399 0.26721761 0.22176315 0.28595236 
##       1331       1332       1333       1334       1335       1336       1337 
## 0.17706443 0.28726056 0.28089705 0.21083123 0.26869510 0.41170152 0.17263195 
##       1338       1339       1340       1341       1342       1343       1344 
## 0.31378463 0.16232514 0.21073698 0.20442313 0.26545281 0.13386239 0.36727698 
##       1345       1346       1347       1348       1349       1350       1351 
## 0.30308746 0.27345587 0.23601911 0.21732044 0.22353638 0.24664790 0.26365079 
##       1352       1353       1354       1355       1356       1357       1358 
## 0.32520097 0.18008298 0.26698363 0.40596097 0.26989999 0.29840052 0.33078676 
##       1359       1360       1361       1362       1363       1364       1365 
## 0.28113005 0.23715487 0.26203811 0.26578090 0.17538814 0.24429494 0.32077088 
##       1366       1367       1368       1369       1370       1371       1372 
## 0.26680859 0.37608931 0.22665512 0.24242140 0.17584745 0.33697214 0.19218619 
##       1373       1374       1375       1376       1377       1378       1379 
## 0.24642246 0.27078690 0.24755786 0.24492908 0.20250493 0.15947823 0.27899020 
##       1380       1381       1382       1383       1384       1385       1386 
## 0.29765147 0.25518464 0.21412805 0.44335079 0.20116219 0.25241936 0.28730541 
##       1387       1388       1389       1390       1391       1392       1393 
## 0.27899628 0.24945803 0.30905140 0.16202510 0.33932031 0.32045223 0.22499681 
##       1394       1395       1396       1397       1398       1399       1400 
## 0.24517058 0.16558071 0.27433512 0.40424251 0.29501528 0.26963745 0.12900282 
##       1401       1402       1403       1404       1405       1406       1407 
## 0.26674850 0.19615616 0.35685921 0.26897005 0.24628340 0.34601733 0.32700855 
##       1408       1409       1410       1411       1412       1413       1414 
## 0.28326221 0.34192055 0.35666507 0.42113755 0.32663906 0.18667032 0.24141680 
##       1415       1416       1417       1418       1419       1420       1421 
## 0.26680931 0.19635814 0.27937148 0.22109690 0.35181505 0.29170474 0.36528925 
##       1422       1423       1424       1425       1426       1427       1428 
## 0.27006044 0.18624026 0.30060042 0.28878633 0.19780881 0.15583780 0.29457985 
##       1429       1430       1431       1432       1433       1434       1435 
## 0.25340798 0.20054806 0.24343529 0.20703821 0.35922717 0.17164750 0.27251733 
##       1436       1437       1438       1439       1440       1441       1442 
## 0.18721453 0.16663330 0.25850776 0.33156683 0.23555315 0.18167893 0.23690670 
##       1443       1444       1445       1446       1447       1448       1449 
## 0.19291315 0.22273807 0.18271269 0.17154498 0.19222959 0.16869923 0.38034198 
##       1450       1451       1452       1453       1454       1455       1456 
## 0.18816388 0.29592835 0.22208033 0.23469099 0.20497095 0.25774978 0.15760588 
##       1457       1458       1459       1460       1461       1462       1463 
## 0.28693486 0.16691237 0.19682520 0.24920565 0.34705251 0.30828814 0.24959829 
##       1464       1465       1466       1467       1468       1469       1470 
## 0.21259678 0.32753045 0.25954507 0.29884594 0.25080116 0.32056080 0.33579067 
##       1471       1472       1473       1474       1475       1476       1477 
## 0.21458389 0.20784647 0.18877137 0.20818518 0.28040776 0.16458623 0.23093717 
##       1478       1479       1480       1481       1482       1483       1484 
## 0.20951105 0.09490325 0.24396273 0.15689804 0.27053535 0.33707622 0.28648327 
##       1485       1486       1487       1488       1489       1490       1491 
## 0.28805226 0.22523794 0.27272055 0.12294406 0.17913775 0.15828471 0.12030567 
##       1492       1493       1494       1495       1496       1497       1498 
## 0.27601148 0.19442894 0.19653917 0.19558745 0.26787705 0.18537367 0.28772455 
##       1499       1500       1501       1502       1503       1504       1505 
## 0.28579665 0.33010694 0.26384091 0.37760301 0.42313435 0.44554852 0.43575751 
##       1506       1507       1508       1509       1510       1511       1512 
## 0.15044529 0.25781978 0.21435688 0.36277450 0.24039092 0.34823911 0.15587339 
##       1513       1514       1515       1516       1517       1518       1519 
## 0.33812635 0.34024813 0.10977229 0.14657966 0.24766153 0.28799494 0.36561448 
##       1520       1521       1522       1523       1524       1525       1526 
## 0.26500334 0.24785884 0.30608120 0.21937112 0.23846379 0.25305605 0.11045548 
##       1527       1528       1529       1530       1531       1532       1533 
## 0.26352782 0.21105796 0.29383310 0.25501309 0.17946942 0.22785554 0.20743565 
##       1534       1535       1536       1537       1538       1539       1540 
## 0.22162870 0.20115145 0.18822158 0.18612275 0.16939853 0.28977198 0.27401952 
##       1541       1542       1543       1544       1545       1546       1547 
## 0.18801129 0.20769874 0.21717144 0.41864908 0.31362988 0.34877650 0.28233354 
##       1548       1549       1550       1551       1552       1553       1554 
## 0.34790715 0.19688969 0.24773259 0.24411763 0.25891895 0.21575107 0.22356852 
##       1555       1556       1557       1558       1559       1560       1561 
## 0.24909731 0.27680220 0.23996567 0.33563145 0.17372436 0.31982937 0.23666865 
##       1562       1563       1564       1565       1566 
## 0.25338317 0.26074372 0.25011835 0.38404053 0.25021118
```
]

---

class: title title-1

# Example

.small[

```r
*library(broom)

glm(qsmk ~ wt71 + age + marital + race + sex, 
    data = nhefs_complete_uc,
    family = binomial()) %&gt;%
  augment(type.predict = "response",
          data = nhefs_complete_uc)
```
]

---

class: title title-1

# Example

.small[

```r
*library(broom)

glm(qsmk ~ wt71 + age + marital + race + sex, 
    data = nhefs_complete_uc,
    family = binomial()) %&gt;%
* augment(type.predict = "response",
          data = nhefs_complete_uc)
```
]

---

class: title title-1

# Example

.small[

```r
*library(broom)

glm(qsmk ~ wt71 + age + marital + race + sex, 
    data = nhefs_complete_uc,
    family = binomial()) %&gt;%
  augment(type.predict = "response", 
*         data = nhefs_complete_uc)
```
]

---
class: title title-1

# Example

.small[

```r
*nhefs_complete_uc &lt;-
  glm(qsmk ~ wt71 + age + marital + race + sex, 
      data = nhefs_complete_uc,
      family = binomial()) %&gt;%
  augment(type.predict = "response",
          data = nhefs_complete_uc) 

nhefs_complete_uc %&gt;% 
  select(qsmk, .fitted)
```
]

---
class: title title-1

# Example

.pull-left[
.small[

```r
nhefs_complete_uc &lt;-
  glm(qsmk ~ wt71 + age + marital + race + sex, 
      data = nhefs_complete_uc,
      family = binomial()) %&gt;%
  augment(type.predict = "response",
          data = nhefs_complete_uc) 

*nhefs_complete_uc %&gt;%
* select(qsmk, .fitted)
```
]
]

.pull-right[

```
## # A tibble: 1,566 × 2
##     qsmk .fitted
##    &lt;dbl&gt;   &lt;dbl&gt;
##  1     0   0.192
##  2     0   0.238
##  3     0   0.181
##  4     0   0.262
##  5     0   0.295
##  6     0   0.172
##  7     0   0.299
##  8     0   0.182
##  9     0   0.315
## 10     0   0.273
## # … with 1,556 more rows
```
]

---

class: title title-1

# <svg aria-hidden="true" role="img" viewBox="0 0 640 512" style="height:1em;width:1.25em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M624 416H381.54c-.74 19.81-14.71 32-32.74 32H288c-18.69 0-33.02-17.47-32.77-32H16c-8.8 0-16 7.2-16 16v16c0 35.2 28.8 64 64 64h512c35.2 0 64-28.8 64-64v-16c0-8.8-7.2-16-16-16zM576 48c0-26.4-21.6-48-48-48H112C85.6 0 64 21.6 64 48v336h512V48zm-64 272H128V64h384v256z"/></svg> Application Exercise


```r
nhefs_complete_uc &lt;- nhefs_complete %&gt;% 
  filter(censored == 0)
```

1. `install.packages("broom")`
2. Fit a propensity score model using the confounders you identified that are in the NHEFS data
3. Knit commit &amp; push to GitHub

<div class="countdown" id="timer_62114ebc" style="right:0;bottom:0;font-size:2em;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">08</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

class: title title-1

# Propensity Score

.footer[Imbens and Rubin (2015) Causal Inference]


.box-inv-1.medium[
`$$e(z) = P(X = 1 | Z = z)$$`
]


.box-1[
The propensity score is a *balancing score*. Conditional on the propensity score, the distribution of `\(\mathbf{Z}\)` is similar between the exposed `\((X=1)\)` and unexposed `\((X=0)\)` units.
]

---

class: title title-1

# Histogram

.left-code[

```r
library(ggplot2)

ggplot(nhefs_complete_uc, 
       aes(x = .fitted, 
           fill = as.factor(qsmk))) +
  geom_histogram(bins = 30)
```
]

.right-plot[
&lt;img src="09-propensity-score_files/figure-html/unnamed-chunk-16-1.png" width="504" style="display: block; margin: auto;" /&gt;
]
---

class: title title-1

# Histogram

.left-code[

```r
library(ggplot2)

ggplot(nhefs_complete_uc, 
       aes(x = .fitted, 
           fill = as.factor(qsmk))) +
  geom_histogram(bins = 30) + 
  labs(
*   fill = "Quit Smoking\n(1 = Yes, 0 = No)")
```
]

.right-plot[
&lt;img src="09-propensity-score_files/figure-html/hist-out-1.png" width="504" style="display: block; margin: auto;" /&gt;
]
---

class: title title-1

# Histogram
.left-code[

```r
library(ggplot2)

ggplot(nhefs_complete_uc, 
       aes(x = .fitted, 
           fill = as.factor(qsmk))) +
  geom_histogram(bins = 30) + 
  labs(
    fill = "Quit Smoking\n(1 = Yes, 0 = No)",
*   x = "propensity score")
```
]

.right-plot[
&lt;img src="09-propensity-score_files/figure-html/unnamed-chunk-17-1.png" width="504" style="display: block; margin: auto;" /&gt;
]
---
class: title title-1

# Mirrored Histogram

.small[

```r
df_plot_ps &lt;- nhefs_complete_uc %&gt;%
  tidyr::pivot_wider(names_from = qsmk, 
                     values_from = .fitted, 
                     names_prefix = "qsmk_p")
```
]

---

class: title title-1

# Mirrored Histogram

.left-code[
.small[

```r
ggplot(df_plot_ps) +
  geom_histogram(bins = 50, 
                 aes(x = qsmk_p1), 
                 fill = "cornflower blue") + 
  geom_histogram(bins = 50, 
                 aes(x = qsmk_p0, 
                     y = - stat(count)), 
                 fill = "orange") + 
  scale_y_continuous("count", label = abs) + 
  scale_x_continuous("propensity score")
```
]
]

.right-plot[
&lt;img src="09-propensity-score_files/figure-html/unnamed-chunk-19-1.png" width="504" style="display: block; margin: auto;" /&gt;
]


---
class: title title-1

# Mirrored Histogram

.left-code[
.small[

```r
ggplot(df_plot_ps) +
  geom_histogram(bins = 50, 
                 aes(x = qsmk_p1), 
                 fill = "cornflower blue") + 
  geom_histogram(bins = 50, 
                 aes(x = qsmk_p0, 
                     y = - stat(count)), 
                 fill = "orange") + 
  scale_y_continuous("count", label = abs) + 
  scale_x_continuous("propensity score") +
  geom_label(
    label = "Quit smoking", 
    x = 0.25,
    y = 3,
  ) + 
  geom_label(
    label = "Didn't quit smoking",
    x = 0.25, 
    y = -3
  ) + 
  theme_minimal()
```
]
]

.right-plot[
&lt;img src="09-propensity-score_files/figure-html/unnamed-chunk-20-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

class: title title-1

# <svg aria-hidden="true" role="img" viewBox="0 0 640 512" style="height:1em;width:1.25em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M624 416H381.54c-.74 19.81-14.71 32-32.74 32H288c-18.69 0-33.02-17.47-32.77-32H16c-8.8 0-16 7.2-16 16v16c0 35.2 28.8 64 64 64h512c35.2 0 64-28.8 64-64v-16c0-8.8-7.2-16-16-16zM576 48c0-26.4-21.6-48-48-48H112C85.6 0 64 21.6 64 48v336h512V48zm-64 272H128V64h384v256z"/></svg> Application Exercise

1. Create a mirrored histogram of your propensity scores
2. Update the theme of and colors of your plot

<div class="countdown" id="timer_62114edd" style="right:0;bottom:0;font-size:2em;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">08</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9",
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
